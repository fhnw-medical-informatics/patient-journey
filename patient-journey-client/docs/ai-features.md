# Documentation: Patient Journey AI Features

Our Patient Journey application is a powerful tool for medical data analysis and exploration. It utilizes OpenAI's Embeddings API and other algorithms to enable users to load prepared datasets of patient journeys and explore them in a variety of ways.

---

## AI Feature Documentation

### Embeddings based patient similarity

When loading the dataset, each patient journey is converted from structured data into a more human readable full-text version of the patient journey, that is easier to understand by both humans, but also by the AI. This full-text version is then sent to the OpenAI Embeddings API, which returns a vector representation of each patient journey.

This vector representation can then be used to find similar patient journeys in the dataset in 2 ways:

#### 1. Using index patients

The user can select a patient as an index patient. The application then uses cosine similarity to find patient journeys in the dataset that are similar to the index patient.

#### 2. Prompt based similarity

Users can compose a prompt describing a patient journey. This prompt is sent to the Embeddings API, which returns an embedding. The application then uses cosine similarity to find patient journeys in the dataset that are similar to the given prompt.

### Finding Clusters

#### 2D Plot

The application uses t-Distributed Stochastic Neighbor Embedding (t-SNE) to reduce the dimensionality of the data (embeddings) and project it onto a 2D plot. This enables users to visually explore the data and find patterns or outliers.

#### Data Clustering

Using the k-means clustering algorithm, the application clusters the patient journeys based on their embeddings generated by OpenAI's Embeddings API. This allows users to find groups of similar patient journeys and analyze common patterns.

#### Cluster Explanation

This feature leverages OpenAI's ChatGPT to provide explanations of the defining characteristics of each cluster. Users can request a summary of the factors that define the patient journeys in a selected cluster. The cluster selection can be done by manually picking patient journeys on the 2D plot and add them to a cohort. The user can then send the patient journeys of the cohort together with a prompt to the ChatGPT API. The response of the API is then displayed to the user. The prompt can, for example, ask the AI to describe the defining characteristics of the patient journeys in the cohort; Or it can ask the AI to describe the differences between the patient journeys in the cohort and the rest of the dataset. Or you can ask why these patient journeys are similar to each other.

---

## Limitations and Areas of Research

### Data Preparation

The quality of the embeddings and, consequently, the effectiveness of the exploration features depend heavily on how well the patient journey data is prepared before being sent to the Embeddings API. This is an area of reasearch where we should explore different approaches to data preparation and discover how this impacts the perforamnce of the application.

Questions to explore:

- How much data should be included in the patient journey?
- How should the data be structured?
- How verbose should the data be? (e.g. should we include the names of the procedures or just the codes?)

### Prompt Engineering

The quality of explanations provided by the "Cluster Explanation" feature depends on the context and prompt we provide to the ChatGPT API. Further research is needed in the area of prompt engineering to improve the quality of these explanations.

Questions to explore:

- How should the prompt be structured?
- What can we prompts for?
- How should the prompt be combined with the patient journey data?
- What `system`-Role instruction should we use?

### Finding similar Patients or Clusters

Currently, the "Prompt based Similarity" feature is not performing as expected. It's not clear as to why this is. Maybe due to the token input limit of the Embeddings API, which results in the generation of embeddings for the prompt with missing context. More research is needed to fine-tune this process.

Update: We are currently just searching for similar patient journeys by finding the closest embeddings to the prompt embedding. But this is just the first step, we could then use the LLM to interpret the most similar patient journeys and generate a fitting response (for example it could extract the cluster of the most similar patient journeys and describe it in a further step). Here are some resources that could help us with this:

- https://blog.langchain.dev/tutorial-chatgpt-over-your-data/
- https://platform.openai.com/docs/guides/embeddings/limitations-risks
- https://platform.openai.com/docs/tutorials/web-qa-embeddings

Update 2: Also we are fetching the embeddings to compare with the patient journey embeddings based on the prompt. However, another strategy would be to use the prompt to ask ChatGPT to create a new patient journey that matches the prompt. We could then use the Embeddings API to generate an embedding for this new patient journey and compare it to the embeddings of the patient journeys in the dataset.

Questions to explore:

- How should the prompt be written, so that the Embeddings API can generate accurate embeddings for it, that are comparable to the embeddings of the dataset?
- What context should be included in the prompt?
- How can we provide a more diverse set of contextual data to the Embeddings API?
- How does it perform with different datasets and different data preparation approaches?

### t-SNE and K-means Configuration

We are currently using the t-SNE and k-means algorithms with default parameters. To optimize our data visualization and clustering, we should experiment with various configurations of these algorithms.

### Experimentation with Different LLMs and/or fine-tuned models

To improve our embeddings and prompt responses, we can experiment with different Large Language Models (LLMs) such as LLaMA or MedPaLM 2. We can also experiment with fine-tuned models to improve their performance.

---

## Further Features Ideas

### Fully automatic Clustering and Cluster Description

We are planning to integrate an automatic clustering feature that uses OpenAI's technology to cluster data and describe the characteristics of each cluster right at the time of loading the dataset. Each cluster would then be already labelled and is ready to be explored by the user.

### Cluster Discovery Using Prompts

We are working on a new feature that will allow users to search for additional clusters by providing a prompt, offering a more intuitive and user-friendly way to explore data.
